# Расширенное техническое задание

## 1. Введение
Данное техническое задание описывает требования к разработке программного обеспечения, обеспечивающего интеграцию тренажёров DanteSport с блоками управления DC2 в программный комплекс Ergrace (https://www.concept2.com/ergrace), предназначенный для проведения соревнований на тренажёрах Concept2 (PM5) и DanteSport (DC2) в смешанном режиме.

Существует блок управления PM5, устанавливаемый на тренажёры академической гребли Concept2. Блоки PM5 могут быть объединены между собой посредством интерфейса RS485. Первый блок подключается к ПК посредством USB. Специальное программное обеспечение Ergrace позволяет управлять подключёнными тренажёрами с целью проведения соревнований. Управление включает, но не ограничивается:
* назначением номеров дорожек
* передачей в PM5 информации о типе соревнования, расстоянии и участнике
* запуском и остановкой соревнования
* получением информации от тренажёра о текущем состоянии, пройденной дистанции и т.п.

Существует тренажёр собственного производства DanteSport с блоком управления DC2. Блоки DC2 могут подключаться к сети WiFi и передавать данные о своём состоянии, а также управляться в том же объёме, что и PM5, но имеют собственный протокол обмена.

## 2. Цель работы
Реализовать возможность подключения нескольких блоков DC2 к программе Ergrace с целью управления блоками DC2 в том же объёме функционирования, что и PM5, для проведения соревнований в смешанном варианте тренажёров Concept2 и DanteSport.

В результате работы должны быть разработаны:
1. Программное обеспечение, имитирующее протокол обмена PM5 для подключения нескольких блоков DC2 к программе Ergrace (в виде встроенного ПО для OrangePy или программы на ПК).
2. Описание протокола обмена.
3. Описание конфигурации аппаратного оборудования в случае решения со встроенным ПО.

## 3. Общие требования
- Поддержка неограниченного количества блоков DC2 и PM5 в одной сессии.
- Работа только в локальной сети.
- Автоматическое обнаружение устройств DC2 при их появлении в сети.

## 4. Архитектура решения
- Разрабатывается программный шлюз/эмулятор, который эмулирует работу блоков PM5 для Ergrace, обеспечивая взаимодействие с DC2 по WiFi.
- Программное обеспечение не заменяет Ergrace, а подыгрывает ему, обеспечивая прозрачную интеграцию DC2.
- Взаимодействие с DC2 осуществляется по предоставленному протоколу обмена.
- Взаимодействие с Ergrace — по протоколу PM5 (предположительно CSAFE).

## 5. Функциональные требования
- Полная автоматизация работы шлюза (минимизация ручных операций).
- Пользовательский интерфейс для:
  - Первичной настройки шлюза.
  - Контроля состояния подключённых устройств.
  - Тестирования соединения и обмена данными.
- Поддержка всех функций управления, реализованных для PM5:
  - Назначение номеров дорожек.
  - Передача информации о типе соревнования, расстоянии, участнике.
  - Запуск и остановка соревнования.
  - Получение информации о состоянии тренажёра, пройденной дистанции и т.п.

## 6. Требования к протоколу обмена
- Используется предоставленный заказчиком протокол обмена с DC2.
- Реализуется эмуляция протокола PM5 для взаимодействия с Ergrace.

## 7. Требования к тестированию
- Обязательные сценарии тестирования:
  - Подключение и отключение устройств DC2 в реальном времени.
  - Одновременное управление смешанными тренажёрами (PM5 и DC2).
  - Передача некорректных или повреждённых данных.
  - Потеря связи с отдельными устройствами DC2.
  - Масштабирование (работа с большим количеством устройств).
  - Проведение соревнований с разными типами тренажёров.
- Для тестирования шлюза требуется эмуляция протокола Ergrace без наличия реальных DC2.

## 8. Требования к документации
- Документация предоставляется на русском языке.
- Минимально достаточный состав документации:
  - Описание архитектуры решения.
  - Описание используемых протоколов обмена.
  - Руководство по установке и настройке шлюза.
  - Руководство пользователя (описание интерфейса, основные сценарии работы).
  - Описание тестовых сценариев.

## 9. Требования к поддержке
- Планируется дальнейшая поддержка и обновление программного обеспечения после завершения проекта.

## 10. Ограничения и исключения
- Нет требований к безопасности и шифрованию данных.
- Нет требований к сертификации или соответствию стандартам.
- Не требуется эмуляция DC2.
- Обучение персонала заказчика не требуется. 